!function(){"use strict";angular.module("app",["ui.router","app.ui","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,e,r){e.otherwise("/projects"),t.state("login",{url:"/login",templateUrl:"partials/login/index.html",controller:"LoginController",controllerAs:"loginController"}).state("projects",{url:"/projects",templateUrl:"partials/projects/index.html",controller:"ProjectsController",controllerAs:"projectsController",resolve:{projects:["Projects","users",function(t,e){return t.get()}],users:["Users",function(t){return t.get()}]},data:{requiresLogin:!0}}).state("projects.detail",{url:"/:projectId",templateUrl:"partials/projects/detail.html",controller:"ProjectController",controllerAs:"projectController",resolve:{project:["Projects","$stateParams","projects",function(t,e,r){return t.find(e.projectId)}]},data:{requiresLogin:!0}}).state("projects.detail.edit",{url:"/edit",templateUrl:"partials/projects/edit.html",controller:"ProjectEditController",controllerAs:"projectEditController",data:{requiresLogin:!0}}),r.interceptors.push(["$injector",function(t){return{request:function(e){var r=t.get("Users");return r.isLoggedIn()&&(e.headers.Authorization="Token "+r.currentUserToken),e}}}])}]).run(["$rootScope","Users","$state",function(t,e,r){t.$on("$stateChangeStart",function(t,o){o.data&&o.data.requiresLogin&&(e.isLoggedIn()||(t.preventDefault(),r.go("login")))})}])}(),function(){"use strict";angular.module("app.ui",[])}(),function(){"use strict";angular.module("app").controller("BodyController",["Projects",function(t){var e=this;e.welcome="Sup",t.get().then(function(r){e.projects=t.projects})}])}(),function(){"use strict";angular.module("app.ui").directive("projectsTable",function(){return{restrict:"EA",templateUrl:"partials/directives/projects-table.html",scope:{projects:"=",remove:"="}}})}(),function(){"use strict";angular.module("app").factory("User",function(){function t(t){_.merge(this,{first_name:"",last_name:"",email:""},t||{})}return t.prototype={fullName:function(){return this.first_name+" "+this.last_name}},t})}(),function(){"use strict";angular.module("app").controller("LoginController",["Users","$state",function(t,e){var r=this;r.creds={},r.login=function(o){t.login(o).then(function(){e.go("projects")},function(t){r.loginFailed=!0})}}])}(),function(){"use strict";angular.module("app.ui").filter("niceDate",function(){return function(t,e){e=e||"MMMM Do, YYYY";var r=moment(t);return r.format(e)}})}(),function(){"use strict";angular.module("app").controller("NewProjectCtrl",["$scope","$modalInstance","Users",function(t,e,r){var o=this;o.users=r.users,o.project={user:""},o.close=function(){e.close(o.project)},o.dismiss=function(){e.dismiss()}}])}(),function(){"use strict";angular.module("app").controller("ProjectEditController",["project","Projects","Users",function(t,e,r){var o=this;o.users=r.users,o.project=t,o.projectCopy=_.clone(t),o.update=e.put}])}(),function(){"use strict";angular.module("app").controller("ProjectController",["project","Projects",function(t,e){var r=this;r.project=t,r.del=e.del}])}(),function(){"use strict";angular.module("app").controller("ProjectsController",["projects","Projects","$modal","Users",function(t,e,r,o){var n=this;n.projects=t,n.remove=e.del,n.currentUser=o.currentUser,n.addProject=function(t){r.open({templateUrl:"partials/projects/new.html",controller:"NewProjectCtrl",controllerAs:"newProject",size:"md"}).result.then(function(t){e.post(t)})}}])}(),function(){"use strict";angular.module("app").service("Projects",["$http","$state","Users",function(t,e,r){var o=this;o.projects=[],o.find=function(t){return _.find(o.projects,{_id:t})},o.get=function(){return t.get("/projects").then(function(t){return o.projects.splice(0),t.data.forEach(function(t){t.user=r.find(t.user),o.projects.push(t)}),o.projects})},o.put=function(r){var n={title:r.title,user:r.user._id};return t.put("/projects/"+r._id,n).then(function(t){var n=o.find(r._id);_.merge(n,r),e.go("projects.detail",{projectId:r._id})},function(t){})},o.remove=function(t){_.remove(o.projects,{_id:t})},o.del=function(r){return t["delete"]("/projects/"+r).then(function(t){o.remove(r),e.go("projects")})},o.post=function(e){return t.post("/projects/",e).then(function(t){t.data.user=r.find(t.data.user),o.projects.push(t.data)})}}])}(),function(){"use strict";angular.module("app").service("Users",["$http","User","$state",function(t,e,r){var o=this;o.currentUser=null,o.currentUserToken=null,o.users=[],o.find=function(t){return _.find(o.users,{_id:t})},o.get=function(){return t.get("/users").then(function(t){return o.users.splice(0),t.data.forEach(function(t){o.users.push(new e(t))}),o.users})},o.login=function(e){return t.post("/login",e).then(function(t){o.currentUser=t.data.user,o.currentUserToken=t.data.token})},o.isLoggedIn=function(){return!!o.currentUser}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJ1aS5tb2R1bGUuanMiLCJib2R5LmNvbnRyb2xsZXIuanMiLCJkaXJlY3RpdmVzL3Byb2plY3RzLXRhYmxlLmRpcmVjdGl2ZS5qcyIsImZhY3Rvcmllcy91c2VyLmZhY3RvcnkuanMiLCJsb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwiZmlsdGVycy9kYXRlLmZpbHRlci5qcyIsInByb2plY3RzL25ldy1wcm9qZWN0LmNvbnRyb2xsZXIuanMiLCJwcm9qZWN0cy9wcm9qZWN0LWVkaXQuY29udHJvbGxlci5qcyIsInByb2plY3RzL3Byb2plY3QuY29udHJvbGxlci5qcyIsInByb2plY3RzL3Byb2plY3RzLmNvbnRyb2xsZXIuanMiLCJzZXJ2aWNlcy9wcm9qZWN0cy5zZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlcnMuc2VydmljZS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwib3RoZXJ3aXNlIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJyZXNvbHZlIiwicHJvamVjdHMiLCJQcm9qZWN0cyIsInVzZXJzIiwiZ2V0IiwiVXNlcnMiLCJkYXRhIiwicmVxdWlyZXNMb2dpbiIsInByb2plY3QiLCIkc3RhdGVQYXJhbXMiLCJmaW5kIiwicHJvamVjdElkIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsIiRpbmplY3RvciIsInJlcXVlc3QiLCJpc0xvZ2dlZEluIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJjdXJyZW50VXNlclRva2VuIiwicnVuIiwiJHJvb3RTY29wZSIsIiRzdGF0ZSIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInByZXZlbnREZWZhdWx0IiwiZ28iLCJ2bSIsInRoaXMiLCJ3ZWxjb21lIiwidGhlbiIsImRpcmVjdGl2ZSIsInJlc3RyaWN0Iiwic2NvcGUiLCJyZW1vdmUiLCJmYWN0b3J5IiwiVXNlciIsIl8iLCJtZXJnZSIsImZpcnN0X25hbWUiLCJsYXN0X25hbWUiLCJlbWFpbCIsInByb3RvdHlwZSIsImZ1bGxOYW1lIiwiY3JlZHMiLCJsb2dpbiIsImVyciIsImxvZ2luRmFpbGVkIiwiZmlsdGVyIiwidGltZVN0YW1wIiwiZm9ybWF0IiwibSIsIm1vbWVudCIsIiRzY29wZSIsIiRtb2RhbEluc3RhbmNlIiwidXNlciIsImNsb3NlIiwiZGlzbWlzcyIsInByb2plY3RDb3B5IiwiY2xvbmUiLCJ1cGRhdGUiLCJwdXQiLCJkZWwiLCIkbW9kYWwiLCJjdXJyZW50VXNlciIsImFkZFByb2plY3QiLCJvcGVuIiwic2l6ZSIsInJlc3VsdCIsInJlcyIsInBvc3QiLCJzZXJ2aWNlIiwiJGh0dHAiLCJfaWQiLCJzcGxpY2UiLCJmb3JFYWNoIiwidGl0bGUiLCJwIiwidXNlcklkIiwidG9rZW4iXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsWUFFQUEsU0FBQUMsT0FBQSxPQUFBLFlBQUEsU0FBQSxpQkFDQUMsUUFBQSxpQkFBQSxxQkFBQSxnQkFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUVBRCxFQUFBRSxVQUFBLGFBRUFILEVBQ0FJLE1BQUEsU0FDQUMsSUFBQSxTQUNBQyxZQUFBLDRCQUNBQyxXQUFBLGtCQUNBQyxhQUFBLG9CQUdBSixNQUFBLFlBQ0FDLElBQUEsWUFDQUMsWUFBQSwrQkFDQUMsV0FBQSxxQkFDQUMsYUFBQSxxQkFDQUMsU0FDQUMsVUFBQSxXQUFBLFFBQUEsU0FBQUMsRUFBQUMsR0FFQSxNQUFBRCxHQUFBRSxRQUdBRCxPQUFBLFFBQUEsU0FBQUUsR0FDQSxNQUFBQSxHQUFBRCxTQUtBRSxNQUNBQyxlQUFBLEtBS0FaLE1BQUEsbUJBQ0FDLElBQUEsY0FDQUMsWUFBQSxnQ0FDQUMsV0FBQSxvQkFDQUMsYUFBQSxvQkFDQUMsU0FDQVEsU0FBQSxXQUFBLGVBQUEsV0FBQSxTQUFBTixFQUFBTyxFQUFBUixHQUNBLE1BQUFD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QTVCLEVBQUFULGlCQUFBbUQsRUFBQWhFLEtBQUEwRSxTQUlBcEQsRUFBQVosV0FBQSxXQUNBLFFBQUFZLEVBQUFxQyIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsndWkucm91dGVyJywgJ2FwcC51aScsICd1aS5ib290c3RyYXAnXSlcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKSB7XG5cbiAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9wcm9qZWN0cycpO1xuXG4gICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgICAgIHVybDonL2xvZ2luJyxcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2xvZ2luL2luZGV4Lmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2xvZ2luQ29udHJvbGxlcidcbiAgICAgICAgfSlcblxuICAgICAgICAuc3RhdGUoJ3Byb2plY3RzJywge1xuICAgICAgICAgIHVybDogJy9wcm9qZWN0cycsXG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9wcm9qZWN0cy9pbmRleC5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnUHJvamVjdHNDb250cm9sbGVyJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6ICdwcm9qZWN0c0NvbnRyb2xsZXInLFxuICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgIHByb2plY3RzOiBmdW5jdGlvbiAoUHJvamVjdHMsIHVzZXJzKSB7XG4gICAgICAgICAgICAgIC8vcmV0dXJucyBhIHByb21pc2UsIGNvbnRyb2xsZXIgaXMgY2FsbGVkIHdoZW4gcHJvbWlzZSBpcyByZXNvbHZlZFxuICAgICAgICAgICAgICByZXR1cm4gUHJvamVjdHMuZ2V0KCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB1c2VyczogZnVuY3Rpb24gKFVzZXJzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBVc2Vycy5nZXQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICByZXF1aXJlc0xvZ2luOiB0cnVlXG4gICAgICAgICAgfVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgLnN0YXRlKCdwcm9qZWN0cy5kZXRhaWwnLCB7XG4gICAgICAgICAgdXJsOiAnLzpwcm9qZWN0SWQnLFxuICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvcHJvamVjdHMvZGV0YWlsLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdQcm9qZWN0Q29udHJvbGxlcicsXG4gICAgICAgICAgY29udHJvbGxlckFzOiAncHJvamVjdENvbnRyb2xsZXInLFxuICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgIHByb2plY3Q6IGZ1bmN0aW9uIChQcm9qZWN0cywgJHN0YXRlUGFyYW1zLCBwcm9qZWN0cykge1xuICAgICAgICAgICAgICByZXR1cm4gUHJvamVjdHMuZmluZCgkc3RhdGVQYXJhbXMucHJvamVjdElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcmVxdWlyZXNMb2dpbjogdHJ1ZVxuICAgICAgICAgIH1cblxuICAgICAgICB9KVxuXG4gICAgICAgIC5zdGF0ZSgncHJvamVjdHMuZGV0YWlsLmVkaXQnLCB7XG4gICAgICAgICAgdXJsOiAnL2VkaXQnLFxuICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvcHJvamVjdHMvZWRpdC5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnUHJvamVjdEVkaXRDb250cm9sbGVyJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6ICdwcm9qZWN0RWRpdENvbnRyb2xsZXInLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHJlcXVpcmVzTG9naW46IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIFxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaChmdW5jdGlvbiAoJGluamVjdG9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgdmFyIFVzZXJzID0gJGluamVjdG9yLmdldCgnVXNlcnMnKTtcbiAgICAgICAgICAgIGlmIChVc2Vycy5pc0xvZ2dlZEluKCkpIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnVG9rZW4gJyArIFVzZXJzLmN1cnJlbnRVc2VyVG9rZW47XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0pXG5cbiAgICAucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlLCBVc2VycywgJHN0YXRlKSB7XG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUpIHtcbiAgICAgICAgaWYgKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEucmVxdWlyZXNMb2dpbikge1xuICAgICAgICAgIGlmICghVXNlcnMuaXNMb2dnZWRJbigpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhci5tb2R1bGUoJ2FwcC51aScsIFtdKTtcblxufSgpKTsiLCJcbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ0JvZHlDb250cm9sbGVyJywgZnVuY3Rpb24oUHJvamVjdHMpe1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZtLndlbGNvbWUgPSAnU3VwJztcbiAgICAgIFxuICAgICAgUHJvamVjdHMuZ2V0KClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocHJvamVjdHMpIHtcbiAgICAgICAgICB2bS5wcm9qZWN0cyA9IFByb2plY3RzLnByb2plY3RzO1xuXHR9KTtcbiAgICB9KTtcbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVpJylcbiAgICAuZGlyZWN0aXZlKCdwcm9qZWN0c1RhYmxlJywgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdFQScsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvZGlyZWN0aXZlcy9wcm9qZWN0cy10YWJsZS5odG1sJyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICBwcm9qZWN0czogJz0nLFxuICAgICAgICAgIHJlbW92ZTogJz0nXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSk7XG59KCkpOyIsIihmdW5jdGlvbiAoKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuXHRcdC5mYWN0b3J5KCdVc2VyJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0ZnVuY3Rpb24gVXNlcihkYXRhKSB7XG5cdFx0XHRcdF8ubWVyZ2UodGhpcywge1xuXHRcdFx0XHRcdGZpcnN0X25hbWU6ICcnLFxuXHRcdFx0XHRcdGxhc3RfbmFtZTogJycsXG5cdFx0XHRcdFx0ZW1haWw6ICcnXG5cdFx0XHRcdH0sIGRhdGEgfHwge30pO1xuXHRcdFx0fVxuXG5cdFx0XHRVc2VyLnByb3RvdHlwZSA9IHtcblx0XHRcdFx0ZnVsbE5hbWU6IGZ1bmN0aW9uIGZ1bGxOYW1lKCkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLmZpcnN0X25hbWUgKyAnICcgKyB0aGlzLmxhc3RfbmFtZTtcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdHJldHVybiBVc2VyO1xuXG5cdFx0fSk7XG59KCkpOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgIC5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBmdW5jdGlvbiAoVXNlcnMsICRzdGF0ZSkge1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZtLmNyZWRzID0ge307XG4gICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uIGxvZ2luKGNyZWRzKSB7XG4gICAgICBcdFVzZXJzLmxvZ2luKGNyZWRzKVxuICAgICAgXHQgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIFx0ICBcdCRzdGF0ZS5nbygncHJvamVjdHMnKTtcbiAgICAgIFx0ICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICBcdCAgXHR2bS5sb2dpbkZhaWxlZCA9IHRydWU7XG4gICAgICBcdCAgfSk7XG4gICAgICB9O1xuICAgIH0pO1xufSgpKTsiLCIoZnVuY3Rpb24gKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhci5tb2R1bGUoJ2FwcC51aScpXG5cdFx0LmZpbHRlcignbmljZURhdGUnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24gKHRpbWVTdGFtcCwgZm9ybWF0KSB7XG5cdFx0XHRcdGZvcm1hdCA9IGZvcm1hdCB8fCAnTU1NTSBEbywgWVlZWSc7XG5cdFx0XHRcdHZhciBtID0gbW9tZW50KHRpbWVTdGFtcCk7XG5cdFx0XHRcdHJldHVybiBtLmZvcm1hdChmb3JtYXQpO1xuXHRcdH07XG5cdFxuXHR9KTtcbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgIC5jb250cm9sbGVyKCdOZXdQcm9qZWN0Q3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRtb2RhbEluc3RhbmNlLCBVc2Vycyl7XG4gICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgdm0udXNlcnMgPSBVc2Vycy51c2VycztcbiAgICAgIHZtLnByb2plY3QgPSB7dXNlcjogJyd9O1xuICAgICAgXG5cblxuICAgICAgdm0uY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSgpe1xuICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSh2bS5wcm9qZWN0KTtcblxuICAgICAgfTtcblxuICAgICAgdm0uZGlzbWlzcyA9IGZ1bmN0aW9uIGRpc21pc3MoKXtcbiAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygpO1xuICAgICAgfTtcblxuICAgIH0pO1xufSgpKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignUHJvamVjdEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24gKHByb2plY3QsIFByb2plY3RzLCBVc2Vycykge1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZtLnVzZXJzID0gVXNlcnMudXNlcnM7XG4gICAgICB2bS5wcm9qZWN0ID0gcHJvamVjdDtcbiAgICAgIHZtLnByb2plY3RDb3B5ID0gXy5jbG9uZShwcm9qZWN0KTtcbiAgICAgIHZtLnVwZGF0ZSA9IFByb2plY3RzLnB1dDtcbiAgICB9KTtcbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ1Byb2plY3RDb250cm9sbGVyJywgZnVuY3Rpb24gKHByb2plY3QsUHJvamVjdHMpIHtcbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2bS5wcm9qZWN0ID0gcHJvamVjdDtcbiAgICAgIHZtLmRlbCA9IFByb2plY3RzLmRlbDtcbiAgICB9KTtcbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ1Byb2plY3RzQ29udHJvbGxlcicsIGZ1bmN0aW9uIChwcm9qZWN0cywgUHJvamVjdHMsICRtb2RhbCwgVXNlcnMpIHtcbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2bS5wcm9qZWN0cyA9IHByb2plY3RzO1xuICAgICAgdm0ucmVtb3ZlID0gUHJvamVjdHMuZGVsO1xuICAgICAgdm0uY3VycmVudFVzZXIgPSBVc2Vycy5jdXJyZW50VXNlcjtcblxuICAgICAgLyogQWRkaW5nIGEgbmV3IHByb2plY3QgKi9cbiAgICAgIHZtLmFkZFByb2plY3QgPSBmdW5jdGlvbiBhZGRQcm9qZWN0KHByb2plY3QpIHtcbiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkbW9kYWwub3Blbih7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9wcm9qZWN0cy9uZXcuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjogJ05ld1Byb2plY3RDdHJsJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6ICduZXdQcm9qZWN0JyxcbiAgICAgICAgICBzaXplOiAnbWQnXG4gICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIFByb2plY3RzLnBvc3QocmVzKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfSk7XG59KCkpOyIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLnNlcnZpY2UoJ1Byb2plY3RzJywgZnVuY3Rpb24gKCRodHRwLCAkc3RhdGUsIFVzZXJzKSB7XG4gICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgdm0ucHJvamVjdHMgPSBbXTtcblxuICAgICAgdm0uZmluZCA9IGZ1bmN0aW9uIGZpbmQocHJvamVjdElkKSB7XG4gICAgICAgIHJldHVybiBfLmZpbmQodm0ucHJvamVjdHMsIHtfaWQ6IHByb2plY3RJZH0pO1xuICAgICAgfTtcblxuICAgICAgdm0uZ2V0ID0gZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvcHJvamVjdHMnKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgIFx0ICAgIFxuICAgICAgICAgICAgdm0ucHJvamVjdHMuc3BsaWNlKDApO1xuXG4gICAgICBcdCAgICByZXMuZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9qZWN0KSB7XG4gICAgICAgICAgICAgICBwcm9qZWN0LnVzZXIgPSBVc2Vycy5maW5kKHByb2plY3QudXNlcik7XG4gICAgXHQgICAgICAgICB2bS5wcm9qZWN0cy5wdXNoKHByb2plY3QpO1xuICAgIFx0ICAgICAgfSk7XG5cbiAgICBcdCAgICAgIHJldHVybiB2bS5wcm9qZWN0cztcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZtLnB1dCA9IGZ1bmN0aW9uIHB1dChwcm9qZWN0Q29weSkge1xuICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICB0aXRsZTogcHJvamVjdENvcHkudGl0bGUsXG4gICAgICAgICAgdXNlcjogcHJvamVjdENvcHkudXNlci5faWRcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvcHJvamVjdHMvJyArIHByb2plY3RDb3B5Ll9pZCwgZGF0YSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICAgIHZhciBwID0gdm0uZmluZChwcm9qZWN0Q29weS5faWQpO1xuICAgICAgICAgICAgXy5tZXJnZShwLCBwcm9qZWN0Q29weSk7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ3Byb2plY3RzLmRldGFpbCcsIHtwcm9qZWN0SWQ6IHByb2plY3RDb3B5Ll9pZH0pO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIC8vVE9ETzogaGFuZGxlIHdoZW4gd2UgY2FuJ3QgdXBkYXRlIGEgcHJvamVjdC5cbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIC8vdGVsbCBzZXJ2ZXIgdG8gZGVsZXRlIChyZW1vdmUpIGZyb20gZGF0YWJhc2VcbiAgICAgIHZtLnJlbW92ZSA9IGZ1bmN0aW9uIHJlbW92ZShwcm9qZWN0SWQpIHtcbiAgICAgICAgIF8ucmVtb3ZlKHZtLnByb2plY3RzLCB7X2lkOiBwcm9qZWN0SWR9KTtcbiAgICAgIH07XG5cbiAgICAgIHZtLmRlbCA9IGZ1bmN0aW9uIGRlbChwcm9qZWN0SWQpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSgnL3Byb2plY3RzLycgKyBwcm9qZWN0SWQpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgdm0ucmVtb3ZlKHByb2plY3RJZCk7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ3Byb2plY3RzJyk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAvL3RlbGwgc2VydmVyIHRvIHBvc3QgKHNhdmUpIHRvIHRoZSBkYXRhYmFzZVxuICAgICAgdm0ucG9zdCA9IGZ1bmN0aW9uIHBvc3QocHJvamVjdCkge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL3Byb2plY3RzLycsIHByb2plY3QpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgcmVzLmRhdGEudXNlciA9IFVzZXJzLmZpbmQocmVzLmRhdGEudXNlcik7XG4gICAgICAgICAgICB2bS5wcm9qZWN0cy5wdXNoKHJlcy5kYXRhKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgIH0pO1xufSgpKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAuc2VydmljZSgnVXNlcnMnLCBmdW5jdGlvbiAoJGh0dHAsIFVzZXIsICRzdGF0ZSl7XG4gICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICB2bS5jdXJyZW50VXNlciA9IG51bGw7XG5cbiAgICAgIHZtLmN1cnJlbnRVc2VyVG9rZW4gPSBudWxsO1xuXG4gICAgICB2bS51c2VycyA9IFtdO1xuXG4gICAgICB2bS5maW5kID0gZnVuY3Rpb24gZmluZCh1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuIF8uZmluZCh2bS51c2Vycywge19pZDogdXNlcklkfSk7XG4gICAgICB9O1xuXG4gICAgICAvL2dldCB1c2VycyBmcm9tIHRoZSBkYXRhYmFzZVxuICAgICAgdm0uZ2V0ID0gZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvdXNlcnMnKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHZtLnVzZXJzLnNwbGljZSgwKTtcblxuICAgICAgICAgICAgcmVzLmRhdGEuZm9yRWFjaChmdW5jdGlvbiAodXNlcikge1xuICAgICAgICAgICAgICB2bS51c2Vycy5wdXNoKG5ldyBVc2VyKHVzZXIpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gdm0udXNlcnM7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uIGxvZ2luKGNyZWRzKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvbG9naW4nLCBjcmVkcylcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlciA9IHJlcy5kYXRhLnVzZXI7XG4gICAgICAgICAgICB2bS5jdXJyZW50VXNlclRva2VuID0gcmVzLmRhdGEudG9rZW47XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2bS5pc0xvZ2dlZEluID0gZnVuY3Rpb24gaXNMb2dnZWRJbigpIHtcbiAgICAgICAgcmV0dXJuICEhdm0uY3VycmVudFVzZXI7XG4gICAgICB9O1xuXG4gICAgfSk7XG59KCkpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
