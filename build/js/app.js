!function(){"use strict";angular.module("app",["ui.router","app.ui","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,e,r){e.otherwise("/projects"),t.state("login",{url:"/login",templateUrl:"partials/login/index.html",controller:"LoginController",controllerAs:"loginController"}).state("projects",{url:"/projects",templateUrl:"partials/projects/index.html",controller:"ProjectsController",controllerAs:"projectsController",resolve:{projects:["Projects","users",function(t,e){return t.get()}],users:["Users",function(t){return t.get()}]},data:{requiresLogin:!0}}).state("projects.detail",{url:"/:projectId",templateUrl:"partials/projects/detail.html",controller:"ProjectController",controllerAs:"projectController",resolve:{project:["Projects","$stateParams","projects",function(t,e,r){return t.find(e.projectId)}]},data:{requiresLogin:!0}}).state("projects.detail.edit",{url:"/edit",templateUrl:"partials/projects/edit.html",controller:"ProjectEditController",controllerAs:"projectEditController",data:{requiresLogin:!0}}),r.interceptors.push(["$injector",function(t){return{request:function(e){var r=t.get("Users");return r.isLoggedIn()&&(e.headers.Authorization="Token "+r.currentUserToken),e}}}])}]).run(["$rootScope","Users","$state",function(t,e,r){t.$on("$stateChangeStart",function(t,o){o.data&&o.data.requiresLogin&&(e.isLoggedIn()||(t.preventDefault(),r.go("login")))})}])}(),function(){"use strict";angular.module("app.ui",[])}(),function(){"use strict";angular.module("app").controller("BodyController",["Projects",function(t){var e=this;e.welcome="Sup",t.get().then(function(r){e.projects=t.projects})}])}(),function(){"use strict";angular.module("app.ui").directive("projectsTable",function(){return{restrict:"EA",templateUrl:"partials/directives/projects-table.html",scope:{projects:"=",remove:"="}}})}(),function(){"use strict";angular.module("app.ui").filter("niceDate",function(){return function(t,e){e=e||"MMMM Do, YYYY";var r=moment(t);return r.format(e)}})}(),function(){"use strict";angular.module("app").factory("User",function(){function t(t){_.merge(this,{first_name:"",last_name:"",email:""},t||{})}return t.prototype={fullName:function(){return this.first_name+" "+this.last_name}},t})}(),function(){"use strict";angular.module("app").service("Projects",["$http","$state","Users",function(t,e,r){var o=this;o.projects=[],o.find=function(t){return _.find(o.projects,{_id:t})},o.get=function(){return t.get("/projects").then(function(t){return o.projects.splice(0),t.data.forEach(function(t){t.user=r.find(t.user),o.projects.push(t)}),o.projects})},o.put=function(r){var n={title:r.title,user:r.user._id};return t.put("/projects/"+r._id,n).then(function(t){var n=o.find(r._id);_.merge(n,r),e.go("projects.detail",{projectId:r._id})},function(t){})},o.remove=function(t){_.remove(o.projects,{_id:t})},o.del=function(r){return t["delete"]("/projects/"+r).then(function(t){o.remove(r),e.go("projects")})},o.post=function(e){return t.post("/projects/",e).then(function(t){t.data.user=r.find(t.data.user),o.projects.push(t.data)})}}])}(),function(){"use strict";angular.module("app").service("Users",["$http","User","$state",function(t,e,r){var o=this;o.currentUser=null,o.currentUserToken=null,o.users=[],o.find=function(t){return _.find(o.users,{_id:t})},o.get=function(){return t.get("/users").then(function(t){return o.users.splice(0),t.data.forEach(function(t){o.users.push(new e(t))}),o.users})},o.login=function(e){return t.post("/login",e).then(function(t){o.currentUser=t.data.user,o.currentUserToken=t.data.token})},o.isLoggedIn=function(){return!!o.currentUser}}])}(),function(){"use strict";angular.module("app").controller("LoginController",["Users","$state",function(t,e){var r=this;r.creds={},r.login=function(o){t.login(o).then(function(){e.go("projects")},function(t){r.loginFailed=!0})}}])}(),function(){"use strict";angular.module("app").controller("NewProjectCtrl",["$scope","$modalInstance","Users",function(t,e,r){var o=this;o.users=r.users,o.project={user:""},o.close=function(){e.close(o.project)},o.dismiss=function(){e.dismiss()}}])}(),function(){"use strict";angular.module("app").controller("ProjectEditController",["project","Projects","Users",function(t,e,r){var o=this;o.users=r.users,o.project=t,o.projectCopy=_.clone(t),o.update=e.put}])}(),function(){"use strict";angular.module("app").controller("ProjectController",["project","Projects",function(t,e){var r=this;r.project=t,r.del=e.del}])}(),function(){"use strict";angular.module("app").controller("ProjectsController",["projects","Projects","$modal","Users",function(t,e,r,o){var n=this;n.projects=t,n.remove=e.del,n.currentUser=o.currentUser,n.addProject=function(t){r.open({templateUrl:"partials/projects/new.html",controller:"NewProjectCtrl",controllerAs:"newProject",size:"md"}).result.then(function(t){e.post(t)})}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJ1aS5tb2R1bGUuanMiLCJib2R5LmNvbnRyb2xsZXIuanMiLCJkaXJlY3RpdmVzL3Byb2plY3RzLXRhYmxlLmRpcmVjdGl2ZS5qcyIsImZpbHRlcnMvZGF0ZS5maWx0ZXIuanMiLCJmYWN0b3JpZXMvdXNlci5mYWN0b3J5LmpzIiwic2VydmljZXMvcHJvamVjdHMuc2VydmljZS5qcyIsInNlcnZpY2VzL3VzZXJzLnNlcnZpY2UuanMiLCJsb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzIiwicHJvamVjdHMvbmV3LXByb2plY3QuY29udHJvbGxlci5qcyIsInByb2plY3RzL3Byb2plY3QtZWRpdC5jb250cm9sbGVyLmpzIiwicHJvamVjdHMvcHJvamVjdC5jb250cm9sbGVyLmpzIiwicHJvamVjdHMvcHJvamVjdHMuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCIkaHR0cFByb3ZpZGVyIiwib3RoZXJ3aXNlIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJyZXNvbHZlIiwicHJvamVjdHMiLCJQcm9qZWN0cyIsInVzZXJzIiwiZ2V0IiwiVXNlcnMiLCJkYXRhIiwicmVxdWlyZXNMb2dpbiIsInByb2plY3QiLCIkc3RhdGVQYXJhbXMiLCJmaW5kIiwicHJvamVjdElkIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsIiRpbmplY3RvciIsInJlcXVlc3QiLCJpc0xvZ2dlZEluIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJjdXJyZW50VXNlclRva2VuIiwicnVuIiwiJHJvb3RTY29wZSIsIiRzdGF0ZSIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInByZXZlbnREZWZhdWx0IiwiZ28iLCJ2bSIsInRoaXMiLCJ3ZWxjb21lIiwidGhlbiIsImRpcmVjdGl2ZSIsInJlc3RyaWN0Iiwic2NvcGUiLCJyZW1vdmUiLCJmaWx0ZXIiLCJ0aW1lU3RhbXAiLCJmb3JtYXQiLCJtIiwibW9tZW50IiwiZmFjdG9yeSIsIlVzZXIiLCJfIiwibWVyZ2UiLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwiZW1haWwiLCJwcm90b3R5cGUiLCJmdWxsTmFtZSIsInNlcnZpY2UiLCIkaHR0cCIsIl9pZCIsInJlcyIsInNwbGljZSIsImZvckVhY2giLCJ1c2VyIiwicHV0IiwicHJvamVjdENvcHkiLCJ0aXRsZSIsInAiLCJlcnIiLCJkZWwiLCJwb3N0IiwiY3VycmVudFVzZXIiLCJ1c2VySWQiLCJsb2dpbiIsImNyZWRzIiwidG9rZW4iLCJsb2dpbkZhaWxlZCIsIiRzY29wZSIsIiRtb2RhbEluc3RhbmNlIiwiY2xvc2UiLCJkaXNtaXNzIiwiY2xvbmUiLCJ1cGRhdGUiLCIkbW9kYWwiLCJhZGRQcm9qZWN0Iiwib3BlbiIsInNpemUiLCJyZXN1bHQiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsWUFFQUEsU0FBQUMsT0FBQSxPQUFBLFlBQUEsU0FBQSxpQkFDQUMsUUFBQSxpQkFBQSxxQkFBQSxnQkFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUVBRCxFQUFBRSxVQUFBLGFBRUFILEVBQ0FJLE1BQUEsU0FDQUMsSUFBQSxTQUNBQyxZQUFBLDRCQUNBQyxXQUFBLGtCQUNBQyxhQUFBLG9CQUdBSixNQUFBLFlBQ0FDLElBQUEsWUFDQUMsWUFBQSwrQkFDQUMsV0FBQSxxQkFDQUMsYUFBQSxxQkFDQUMsU0FDQUMsVUFBQSxXQUFBLFFBQUEsU0FBQUMsRUFBQUMsR0FFQSxNQUFBRCxHQUFBRSxRQUdBRCxPQUFBLFFBQUEsU0FBQUUsR0FDQSxNQUFBQSxHQUFBRCxTQUtBRSxNQUNBQyxlQUFBLEtBS0FaLE1BQUEsbUJBQ0FDLElBQUEsY0FDQUMsWUFBQSxnQ0FDQUMsV0FBQSxvQkFDQUMsYUFBQSxvQkFDQUMsU0FDQVEsU0FBQSxXQUFBLGVBQUEsV0FBQSxTQUFBTixFQUFBTyxFQUFBUixHQUNBLE1BQUFD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QUMsYUFBQSxhQUNBZ0YsS0FBQSxPQUNBQyxPQUFBakQsS0FBQSxTQUFBc0IsR0FDQW5ELEVBQUE2RCxLQUFBViIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsndWkucm91dGVyJywgJ2FwcC51aScsICd1aS5ib290c3RyYXAnXSlcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKSB7XG5cbiAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9wcm9qZWN0cycpO1xuXG4gICAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgICAgIHVybDonL2xvZ2luJyxcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2xvZ2luL2luZGV4Lmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdMb2dpbkNvbnRyb2xsZXInLFxuICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2xvZ2luQ29udHJvbGxlcidcbiAgICAgICAgfSlcblxuICAgICAgICAuc3RhdGUoJ3Byb2plY3RzJywge1xuICAgICAgICAgIHVybDogJy9wcm9qZWN0cycsXG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9wcm9qZWN0cy9pbmRleC5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnUHJvamVjdHNDb250cm9sbGVyJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6ICdwcm9qZWN0c0NvbnRyb2xsZXInLFxuICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgIHByb2plY3RzOiBmdW5jdGlvbiAoUHJvamVjdHMsIHVzZXJzKSB7XG4gICAgICAgICAgICAgIC8vcmV0dXJucyBhIHByb21pc2UsIGNvbnRyb2xsZXIgaXMgY2FsbGVkIHdoZW4gcHJvbWlzZSBpcyByZXNvbHZlZFxuICAgICAgICAgICAgICByZXR1cm4gUHJvamVjdHMuZ2V0KCk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB1c2VyczogZnVuY3Rpb24gKFVzZXJzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBVc2Vycy5nZXQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICByZXF1aXJlc0xvZ2luOiB0cnVlXG4gICAgICAgICAgfVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgLnN0YXRlKCdwcm9qZWN0cy5kZXRhaWwnLCB7XG4gICAgICAgICAgdXJsOiAnLzpwcm9qZWN0SWQnLFxuICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvcHJvamVjdHMvZGV0YWlsLmh0bWwnLFxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdQcm9qZWN0Q29udHJvbGxlcicsXG4gICAgICAgICAgY29udHJvbGxlckFzOiAncHJvamVjdENvbnRyb2xsZXInLFxuICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgIHByb2plY3Q6IGZ1bmN0aW9uIChQcm9qZWN0cywgJHN0YXRlUGFyYW1zLCBwcm9qZWN0cykge1xuICAgICAgICAgICAgICByZXR1cm4gUHJvamVjdHMuZmluZCgkc3RhdGVQYXJhbXMucHJvamVjdElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcmVxdWlyZXNMb2dpbjogdHJ1ZVxuICAgICAgICAgIH1cblxuICAgICAgICB9KVxuXG4gICAgICAgIC5zdGF0ZSgncHJvamVjdHMuZGV0YWlsLmVkaXQnLCB7XG4gICAgICAgICAgdXJsOiAnL2VkaXQnLFxuICAgICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvcHJvamVjdHMvZWRpdC5odG1sJyxcbiAgICAgICAgICBjb250cm9sbGVyOiAnUHJvamVjdEVkaXRDb250cm9sbGVyJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6ICdwcm9qZWN0RWRpdENvbnRyb2xsZXInLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHJlcXVpcmVzTG9naW46IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIFxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaChmdW5jdGlvbiAoJGluamVjdG9yKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgdmFyIFVzZXJzID0gJGluamVjdG9yLmdldCgnVXNlcnMnKTtcbiAgICAgICAgICAgIGlmIChVc2Vycy5pc0xvZ2dlZEluKCkpIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnVG9rZW4gJyArIFVzZXJzLmN1cnJlbnRVc2VyVG9rZW47XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgIH0pXG5cbiAgICAucnVuKGZ1bmN0aW9uICgkcm9vdFNjb3BlLCBVc2VycywgJHN0YXRlKSB7XG4gICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUpIHtcbiAgICAgICAgaWYgKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEucmVxdWlyZXNMb2dpbikge1xuICAgICAgICAgIGlmICghVXNlcnMuaXNMb2dnZWRJbigpKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhci5tb2R1bGUoJ2FwcC51aScsIFtdKTtcblxufSgpKTsiLCJcbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ0JvZHlDb250cm9sbGVyJywgZnVuY3Rpb24oUHJvamVjdHMpe1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZtLndlbGNvbWUgPSAnU3VwJztcbiAgICAgIFxuICAgICAgUHJvamVjdHMuZ2V0KClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocHJvamVjdHMpIHtcbiAgICAgICAgICB2bS5wcm9qZWN0cyA9IFByb2plY3RzLnByb2plY3RzO1xuXHR9KTtcbiAgICB9KTtcbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVpJylcbiAgICAuZGlyZWN0aXZlKCdwcm9qZWN0c1RhYmxlJywgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdFQScsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAncGFydGlhbHMvZGlyZWN0aXZlcy9wcm9qZWN0cy10YWJsZS5odG1sJyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICBwcm9qZWN0czogJz0nLFxuICAgICAgICAgIHJlbW92ZTogJz0nXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSk7XG59KCkpOyIsIihmdW5jdGlvbiAoKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyLm1vZHVsZSgnYXBwLnVpJylcblx0XHQuZmlsdGVyKCduaWNlRGF0ZScsIGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbiAodGltZVN0YW1wLCBmb3JtYXQpIHtcblx0XHRcdFx0Zm9ybWF0ID0gZm9ybWF0IHx8ICdNTU1NIERvLCBZWVlZJztcblx0XHRcdFx0dmFyIG0gPSBtb21lbnQodGltZVN0YW1wKTtcblx0XHRcdFx0cmV0dXJuIG0uZm9ybWF0KGZvcm1hdCk7XG5cdFx0fTtcblx0XG5cdH0pO1xufSgpKTsiLCIoZnVuY3Rpb24gKCkge1xuXG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyLm1vZHVsZSgnYXBwJylcblx0XHQuZmFjdG9yeSgnVXNlcicsIGZ1bmN0aW9uICgpIHtcblx0XHRcdGZ1bmN0aW9uIFVzZXIoZGF0YSkge1xuXHRcdFx0XHRfLm1lcmdlKHRoaXMsIHtcblx0XHRcdFx0XHRmaXJzdF9uYW1lOiAnJyxcblx0XHRcdFx0XHRsYXN0X25hbWU6ICcnLFxuXHRcdFx0XHRcdGVtYWlsOiAnJ1xuXHRcdFx0XHR9LCBkYXRhIHx8IHt9KTtcblx0XHRcdH1cblxuXHRcdFx0VXNlci5wcm90b3R5cGUgPSB7XG5cdFx0XHRcdGZ1bGxOYW1lOiBmdW5jdGlvbiBmdWxsTmFtZSgpIHtcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5maXJzdF9uYW1lICsgJyAnICsgdGhpcy5sYXN0X25hbWU7XG5cdFx0XHRcdH1cblx0XHRcdH07XG5cdFx0XHRyZXR1cm4gVXNlcjtcblxuXHRcdH0pO1xufSgpKTsiLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgIC5zZXJ2aWNlKCdQcm9qZWN0cycsIGZ1bmN0aW9uICgkaHR0cCwgJHN0YXRlLCBVc2Vycykge1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZtLnByb2plY3RzID0gW107XG5cbiAgICAgIHZtLmZpbmQgPSBmdW5jdGlvbiBmaW5kKHByb2plY3RJZCkge1xuICAgICAgICByZXR1cm4gXy5maW5kKHZtLnByb2plY3RzLCB7X2lkOiBwcm9qZWN0SWR9KTtcbiAgICAgIH07XG5cbiAgICAgIHZtLmdldCA9IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL3Byb2plY3RzJylcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICBcdCAgICBcbiAgICAgICAgICAgIHZtLnByb2plY3RzLnNwbGljZSgwKTtcblxuICAgICAgXHQgICAgcmVzLmRhdGEuZm9yRWFjaChmdW5jdGlvbiAocHJvamVjdCkge1xuICAgICAgICAgICAgICAgcHJvamVjdC51c2VyID0gVXNlcnMuZmluZChwcm9qZWN0LnVzZXIpO1xuICAgIFx0ICAgICAgICAgdm0ucHJvamVjdHMucHVzaChwcm9qZWN0KTtcbiAgICBcdCAgICAgIH0pO1xuXG4gICAgXHQgICAgICByZXR1cm4gdm0ucHJvamVjdHM7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2bS5wdXQgPSBmdW5jdGlvbiBwdXQocHJvamVjdENvcHkpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgdGl0bGU6IHByb2plY3RDb3B5LnRpdGxlLFxuICAgICAgICAgIHVzZXI6IHByb2plY3RDb3B5LnVzZXIuX2lkXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuICRodHRwLnB1dCgnL3Byb2plY3RzLycgKyBwcm9qZWN0Q29weS5faWQsIGRhdGEpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgICB2YXIgcCA9IHZtLmZpbmQocHJvamVjdENvcHkuX2lkKTtcbiAgICAgICAgICAgIF8ubWVyZ2UocCwgcHJvamVjdENvcHkpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9qZWN0cy5kZXRhaWwnLCB7cHJvamVjdElkOiBwcm9qZWN0Q29weS5faWR9KTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAvL1RPRE86IGhhbmRsZSB3aGVuIHdlIGNhbid0IHVwZGF0ZSBhIHByb2plY3QuXG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICAvL3RlbGwgc2VydmVyIHRvIGRlbGV0ZSAocmVtb3ZlKSBmcm9tIGRhdGFiYXNlXG4gICAgICB2bS5yZW1vdmUgPSBmdW5jdGlvbiByZW1vdmUocHJvamVjdElkKSB7XG4gICAgICAgICBfLnJlbW92ZSh2bS5wcm9qZWN0cywge19pZDogcHJvamVjdElkfSk7XG4gICAgICB9O1xuXG4gICAgICB2bS5kZWwgPSBmdW5jdGlvbiBkZWwocHJvamVjdElkKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUoJy9wcm9qZWN0cy8nICsgcHJvamVjdElkKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHZtLnJlbW92ZShwcm9qZWN0SWQpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9qZWN0cycpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgLy90ZWxsIHNlcnZlciB0byBwb3N0IChzYXZlKSB0byB0aGUgZGF0YWJhc2VcbiAgICAgIHZtLnBvc3QgPSBmdW5jdGlvbiBwb3N0KHByb2plY3QpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLnBvc3QoJy9wcm9qZWN0cy8nLCBwcm9qZWN0KVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHJlcy5kYXRhLnVzZXIgPSBVc2Vycy5maW5kKHJlcy5kYXRhLnVzZXIpO1xuICAgICAgICAgICAgdm0ucHJvamVjdHMucHVzaChyZXMuZGF0YSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICB9KTtcbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLnNlcnZpY2UoJ1VzZXJzJywgZnVuY3Rpb24gKCRodHRwLCBVc2VyLCAkc3RhdGUpe1xuICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgdm0uY3VycmVudFVzZXIgPSBudWxsO1xuXG4gICAgICB2bS5jdXJyZW50VXNlclRva2VuID0gbnVsbDtcblxuICAgICAgdm0udXNlcnMgPSBbXTtcblxuICAgICAgdm0uZmluZCA9IGZ1bmN0aW9uIGZpbmQodXNlcklkKSB7XG4gICAgICAgIHJldHVybiBfLmZpbmQodm0udXNlcnMsIHtfaWQ6IHVzZXJJZH0pO1xuICAgICAgfTtcblxuICAgICAgLy9nZXQgdXNlcnMgZnJvbSB0aGUgZGF0YWJhc2VcbiAgICAgIHZtLmdldCA9IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL3VzZXJzJylcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICB2bS51c2Vycy5zcGxpY2UoMCk7XG5cbiAgICAgICAgICAgIHJlcy5kYXRhLmZvckVhY2goZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgICAgdm0udXNlcnMucHVzaChuZXcgVXNlcih1c2VyKSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHZtLnVzZXJzO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbiBsb2dpbihjcmVkcykge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2xvZ2luJywgY3JlZHMpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgdm0uY3VycmVudFVzZXIgPSByZXMuZGF0YS51c2VyO1xuICAgICAgICAgICAgdm0uY3VycmVudFVzZXJUb2tlbiA9IHJlcy5kYXRhLnRva2VuO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdm0uaXNMb2dnZWRJbiA9IGZ1bmN0aW9uIGlzTG9nZ2VkSW4oKSB7XG4gICAgICAgIHJldHVybiAhIXZtLmN1cnJlbnRVc2VyO1xuICAgICAgfTtcblxuICAgIH0pO1xufSgpKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignTG9naW5Db250cm9sbGVyJywgZnVuY3Rpb24gKFVzZXJzLCAkc3RhdGUpIHtcbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2bS5jcmVkcyA9IHt9O1xuICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbiBsb2dpbihjcmVkcykge1xuICAgICAgXHRVc2Vycy5sb2dpbihjcmVkcylcbiAgICAgIFx0ICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICBcdCAgXHQkc3RhdGUuZ28oJ3Byb2plY3RzJyk7XG4gICAgICBcdCAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgXHQgIFx0dm0ubG9naW5GYWlsZWQgPSB0cnVlO1xuICAgICAgXHQgIH0pO1xuICAgICAgfTtcbiAgICB9KTtcbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAgIC5jb250cm9sbGVyKCdOZXdQcm9qZWN0Q3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRtb2RhbEluc3RhbmNlLCBVc2Vycyl7XG4gICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgdm0udXNlcnMgPSBVc2Vycy51c2VycztcbiAgICAgIHZtLnByb2plY3QgPSB7dXNlcjogJyd9O1xuICAgICAgXG5cblxuICAgICAgdm0uY2xvc2UgPSBmdW5jdGlvbiBjbG9zZSgpe1xuICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSh2bS5wcm9qZWN0KTtcblxuICAgICAgfTtcblxuICAgICAgdm0uZGlzbWlzcyA9IGZ1bmN0aW9uIGRpc21pc3MoKXtcbiAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygpO1xuICAgICAgfTtcblxuICAgIH0pO1xufSgpKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignUHJvamVjdEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24gKHByb2plY3QsIFByb2plY3RzLCBVc2Vycykge1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgIHZtLnVzZXJzID0gVXNlcnMudXNlcnM7XG4gICAgICB2bS5wcm9qZWN0ID0gcHJvamVjdDtcbiAgICAgIHZtLnByb2plY3RDb3B5ID0gXy5jbG9uZShwcm9qZWN0KTtcbiAgICAgIHZtLnVwZGF0ZSA9IFByb2plY3RzLnB1dDtcbiAgICB9KTtcbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ1Byb2plY3RDb250cm9sbGVyJywgZnVuY3Rpb24gKHByb2plY3QsUHJvamVjdHMpIHtcbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2bS5wcm9qZWN0ID0gcHJvamVjdDtcbiAgICAgIHZtLmRlbCA9IFByb2plY3RzLmRlbDtcbiAgICB9KTtcbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ1Byb2plY3RzQ29udHJvbGxlcicsIGZ1bmN0aW9uIChwcm9qZWN0cywgUHJvamVjdHMsICRtb2RhbCwgVXNlcnMpIHtcbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2bS5wcm9qZWN0cyA9IHByb2plY3RzO1xuICAgICAgdm0ucmVtb3ZlID0gUHJvamVjdHMuZGVsO1xuICAgICAgdm0uY3VycmVudFVzZXIgPSBVc2Vycy5jdXJyZW50VXNlcjtcblxuICAgICAgLyogQWRkaW5nIGEgbmV3IHByb2plY3QgKi9cbiAgICAgIHZtLmFkZFByb2plY3QgPSBmdW5jdGlvbiBhZGRQcm9qZWN0KHByb2plY3QpIHtcbiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkbW9kYWwub3Blbih7XG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdwYXJ0aWFscy9wcm9qZWN0cy9uZXcuaHRtbCcsXG4gICAgICAgICAgY29udHJvbGxlcjogJ05ld1Byb2plY3RDdHJsJyxcbiAgICAgICAgICBjb250cm9sbGVyQXM6ICduZXdQcm9qZWN0JyxcbiAgICAgICAgICBzaXplOiAnbWQnXG4gICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIFByb2plY3RzLnBvc3QocmVzKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfSk7XG59KCkpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
